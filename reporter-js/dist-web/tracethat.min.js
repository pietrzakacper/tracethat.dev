"use strict";(()=>{var v=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var Q=(e,r)=>()=>(e&&(r=e(e=0)),r);var f=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),X=(e,r)=>{for(var t in r)v(e,t,{get:r[t],enumerable:!0})},Z=(e,r,t,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let u of H(r))!K.call(e,u)&&u!==t&&v(e,u,{get:()=>r[u],enumerable:!(s=G(r,u))||s.enumerable});return e};var ee=e=>Z(v({},"__esModule",{value:!0}),e);var q={};X(q,{default:()=>re});var d,re,W=Q(()=>{d=null;typeof WebSocket<"u"?d=WebSocket:typeof MozWebSocket<"u"?d=MozWebSocket:typeof global<"u"?d=global.WebSocket||global.MozWebSocket:typeof window<"u"?d=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(d=self.WebSocket||self.MozWebSocket);re=d});var b=f(c=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.registerToken=c.setServerUrl=c.disableDevtools=c.runtimeConfig=void 0;c.runtimeConfig={enabled:!0,serverUrl:"wss://tracethat.dev/report",token:null};var te=()=>{c.runtimeConfig.enabled=!1};c.disableDevtools=te;var ne=e=>{c.runtimeConfig.serverUrl=e};c.setServerUrl=ne;var oe=e=>{c.runtimeConfig.token=e};c.registerToken=oe});var U=f(p=>{"use strict";var se=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0});p.reporter=void 0;var h=se((W(),ee(q))),E=b();function ie(e,r){let t=JSON.stringify(r);e.send(t)}var M=class{constructor(){this.ws=null}async open(){if(E.runtimeConfig.token||await new Promise(t=>setTimeout(t,100)),!E.runtimeConfig.token){console.error("[tracethat.dev] Couldn't open a socket, no token provided");return}let r=E.runtimeConfig.token;return this.ws?.readyState===h.default.OPEN?Promise.resolve():this.ws?.readyState===h.default.CONNECTING?this.connectedPromise:(this.connectedPromise=new Promise((t,s)=>{this.ws=new h.default(`${E.runtimeConfig.serverUrl}?token=${r}`),this.ws.onopen=function(){this._socket?.unref(),t()},this.ws.onerror=s}),this.connectedPromise)}async registerEvent(r){if(await this.open(),!this.ws||this.ws.readyState!==h.default.OPEN){console.error("Couldn't open a socket, failed to send an event");return}ie(this.ws,r)}};p.reporter=new M});var C=f(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});var ce=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),ue=new Map(ce);P.default=ue});var A=f(i=>{"use strict";var B=i&&i.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0});i.errorConstructors=i.isErrorLike=i.deserializeError=i.serializeError=i.NonError=void 0;var ae=B(C()),w=class e extends Error{constructor(r){super(e._prepareSuperMessage(r)),this.name="NonError"}static _prepareSuperMessage(r){try{return JSON.stringify(r)}catch{return String(r)}}};i.NonError=w;var le=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],O=Symbol(".toJSON was called"),fe=e=>{e[O]=!0;let r=e.toJSON();return delete e[O],r},J=e=>ae.default.get(e)??Error,N=({from:e,seen:r,to:t,forceEnumerable:s,maxDepth:u,depth:l,useToJSON:_,serialize:g})=>{if(!t)if(Array.isArray(e))t=[];else if(!g&&j(e)){let n=J(e.name);t=new n}else t={};if(r.push(e),l>=u)return t;if(_&&typeof e.toJSON=="function"&&e[O]!==!0)return fe(e);let m=n=>N({from:n,seen:[...r],forceEnumerable:s,maxDepth:u,depth:l,useToJSON:_,serialize:g});for(let[n,o]of Object.entries(e)){if(typeof Buffer=="function"&&Buffer.isBuffer(o)){t[n]="[object Buffer]";continue}if(o!==null&&typeof o=="object"&&typeof o.pipe=="function"){t[n]="[object Stream]";continue}if(typeof o!="function"){if(!o||typeof o!="object"){t[n]=o;continue}if(!r.includes(e[n])){l++,t[n]=m(e[n]);continue}t[n]="[Circular]"}}for(let{property:n,enumerable:o}of le)typeof e[n]<"u"&&e[n]!==null&&Object.defineProperty(t,n,{value:j(e[n])?m(e[n]):e[n],enumerable:s?!0:o,configurable:!0,writable:!0});return t};function de(e,r={}){let{maxDepth:t=Number.POSITIVE_INFINITY,useToJSON:s=!0}=r;return typeof e=="object"&&e!==null?N({from:e,seen:[],forceEnumerable:!0,maxDepth:t,depth:0,useToJSON:s,serialize:!0}):typeof e=="function"?`[Function: ${e.name??"anonymous"}]`:e}i.serializeError=de;function pe(e,r={}){let{maxDepth:t=Number.POSITIVE_INFINITY}=r;if(e instanceof Error)return e;if(ye(e)){let s=J(e.name);return N({from:e,seen:[],to:new s,maxDepth:t,depth:0,serialize:!1})}return new w(e)}i.deserializeError=pe;function j(e){return!!e&&typeof e=="object"&&"name"in e&&"message"in e&&"stack"in e}i.isErrorLike=j;function ye(e){return!!e&&typeof e=="object"&&"message"in e&&!Array.isArray(e)}var _e=C();Object.defineProperty(i,"errorConstructors",{enumerable:!0,get:function(){return B(_e).default}})});var F=f(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.sleep=y.generateId=void 0;function ge(){return(Math.random()*10**16).toString(32)}y.generateId=ge;function me(e){return new Promise(r=>{setTimeout(r,e)})}y.sleep=me});var R=f(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.FunctionTracer=void 0;var be=A(),L=F(),he=b(),I=class{constructor(r){this.reporter=r}traceThat(r,t){let s=typeof r=="string"?t:r,u=typeof r=="string"?r:r.name||"(anonymous)";return(...l)=>{if(!he.runtimeConfig.enabled)return s(...l);let _=(0,L.generateId)(),g=new Error().stack?.replaceAll(`
`,"").split("at ")?.map(a=>a.trim())?.slice(2),m=new Date().getTime(),n=a=>{let k=new Date().getTime();this.reporter.registerEvent({status:"error",callId:_,name:u,startEpochMs:m,endEpochMs:k,details:{arguments:l,error:(0,be.serializeError)(a),callStack:g}})},o;try{o=s(...l)}catch(a){throw n(a),a}let D=a=>{let k=new Date().getTime();return this.reporter.registerEvent({status:"ok",callId:_,name:u,startEpochMs:m,endEpochMs:k,details:{callStack:g,arguments:l,return:a}}).catch(x=>{console.error("traceThat: Couldn't connect to tracethat.dev server"),console.error(x)}),a};return o instanceof Promise?o.then(D).catch(a=>(n(a),(0,L.sleep)(100).then(()=>Promise.reject(a)))):(D(o),o)}}};S.FunctionTracer=I});var $=f(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.traceThat=void 0;var Ee=U(),we=R(),V=new we.FunctionTracer(Ee.reporter);T.traceThat=V.traceThat.bind(V)});var ke=f(Y=>{Object.defineProperty(Y,"__esModule",{value:!0});var Se=$(),z=b(),Te={disableDevtools:z.disableDevtools,setServerUrl:z.setServerUrl,registerToken:z.registerToken};window.traceThat=Se.traceThat;window.TT=Te});ke();})();
