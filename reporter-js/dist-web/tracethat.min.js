"use strict";(()=>{var C=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Z=Object.prototype.hasOwnProperty;var ee=(e,r)=>()=>(e&&(r=e(e=0)),r);var y=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),re=(e,r)=>{for(var t in r)C(e,t,{get:r[t],enumerable:!0})},te=(e,r,t,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of X(r))!Z.call(e,i)&&i!==t&&C(e,i,{get:()=>r[i],enumerable:!(s=Q(r,i))||s.enumerable});return e};var ne=e=>te(C({},"__esModule",{value:!0}),e);var q={};re(q,{default:()=>oe});var m,oe,B=ee(()=>{m=null;typeof WebSocket<"u"?m=WebSocket:typeof MozWebSocket<"u"?m=MozWebSocket:typeof global<"u"?m=global.WebSocket||global.MozWebSocket:typeof window<"u"?m=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(m=self.WebSocket||self.MozWebSocket);oe=m});var E=y(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.registerToken=l.setServerUrl=l.disableDevtools=l.runtimeConfig=void 0;l.runtimeConfig={enabled:!0,serverUrl:"wss://tracethat.dev/report",token:null};var se=()=>{l.runtimeConfig.enabled=!1};l.disableDevtools=se;var ie=e=>{l.runtimeConfig.serverUrl=e};l.setServerUrl=ie;var ce=e=>{l.runtimeConfig.token=e};l.registerToken=ce});var M=y(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.sleep=w.generateId=void 0;function ae(){return(Math.random()*10**16).toString(32)}w.generateId=ae;function ue(e){return new Promise(r=>{setTimeout(r,e)})}w.sleep=ue});var W=y(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.sha256=h.decrypt=h.encrypt=void 0;async function le(e,r){let t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),i=crypto.getRandomValues(new Uint8Array(12)),u=Array.from(i).map(c=>String.fromCharCode(c)).join(""),f={name:"AES-GCM",iv:i},d=await crypto.subtle.importKey("raw",s,f,!1,["encrypt"]),p=new TextEncoder().encode(e),n=await crypto.subtle.encrypt(f,d,p),_=Array.from(new Uint8Array(n)).map(c=>String.fromCharCode(c)).join("");return btoa(u+_)}h.encrypt=le;async function fe(e,r){let t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),i=atob(e).slice(0,12),f={name:"AES-GCM",iv:new Uint8Array(Array.from(i).map(o=>o.charCodeAt(0)))},d=await crypto.subtle.importKey("raw",s,f,!1,["decrypt"]),p=atob(e).slice(12),n=new Uint8Array(Array.from(p).map(o=>o.charCodeAt(0)));try{let o=await crypto.subtle.decrypt(f,d,n);return new TextDecoder().decode(o)}catch{throw new Error("decrypt failed")}}h.decrypt=fe;async function de(e){let r=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(t)).map(u=>u.toString(16).padStart(2,"0")).join("")}h.sha256=de});var H=y(g=>{"use strict";var pe=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(g,"__esModule",{value:!0});g.reporter=void 0;var A=pe((B(),ne(q))),b=E(),ye=M(),x=W();async function he(e,r){let t=await(0,x.encrypt)(JSON.stringify(r),b.runtimeConfig.token);e.send(t)}var j=class{constructor(){this.ws=null}async open(){return this.connectedPromise&&this.ws?.readyState!==A.default.CLOSED?this.connectedPromise:(this.connectedPromise=(async()=>{if(b.runtimeConfig.token||await(0,ye.sleep)(100),!b.runtimeConfig.token){console.error("[tracethat.dev] Couldn't open a socket, no token provided");return}let r=await(0,x.sha256)(b.runtimeConfig.token);return new Promise((t,s)=>{this.ws=new A.default(`${b.runtimeConfig.serverUrl}?roomId=${r}`),this.ws.onopen=function(){this._socket?.unref(),t()},this.ws.onerror=s})})(),this.connectedPromise)}async registerEvent(r){if(await this.open(),!this.ws||this.ws.readyState!==A.default.OPEN){console.error("Couldn't open a socket, failed to send an event");return}he(this.ws,r)}};g.reporter=new j});var P=y(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});var me=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),we=new Map(me);O.default=we});var L=y(a=>{"use strict";var J=a&&a.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});a.errorConstructors=a.isErrorLike=a.deserializeError=a.serializeError=a.NonError=void 0;var ge=J(P()),S=class e extends Error{constructor(r){super(e._prepareSuperMessage(r)),this.name="NonError"}static _prepareSuperMessage(r){try{return JSON.stringify(r)}catch{return String(r)}}};a.NonError=S;var be=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],I=Symbol(".toJSON was called"),_e=e=>{e[I]=!0;let r=e.toJSON();return delete e[I],r},F=e=>ge.default.get(e)??Error,D=({from:e,seen:r,to:t,forceEnumerable:s,maxDepth:i,depth:u,useToJSON:f,serialize:d})=>{if(!t)if(Array.isArray(e))t=[];else if(!d&&U(e)){let n=F(e.name);t=new n}else t={};if(r.push(e),u>=i)return t;if(f&&typeof e.toJSON=="function"&&e[I]!==!0)return _e(e);let p=n=>D({from:n,seen:[...r],forceEnumerable:s,maxDepth:i,depth:u,useToJSON:f,serialize:d});for(let[n,o]of Object.entries(e)){if(typeof Buffer=="function"&&Buffer.isBuffer(o)){t[n]="[object Buffer]";continue}if(o!==null&&typeof o=="object"&&typeof o.pipe=="function"){t[n]="[object Stream]";continue}if(typeof o!="function"){if(!o||typeof o!="object"){t[n]=o;continue}if(!r.includes(e[n])){u++,t[n]=p(e[n]);continue}t[n]="[Circular]"}}for(let{property:n,enumerable:o}of be)typeof e[n]<"u"&&e[n]!==null&&Object.defineProperty(t,n,{value:U(e[n])?p(e[n]):e[n],enumerable:s?!0:o,configurable:!0,writable:!0});return t};function Ee(e,r={}){let{maxDepth:t=Number.POSITIVE_INFINITY,useToJSON:s=!0}=r;return typeof e=="object"&&e!==null?D({from:e,seen:[],forceEnumerable:!0,maxDepth:t,depth:0,useToJSON:s,serialize:!0}):typeof e=="function"?`[Function: ${e.name??"anonymous"}]`:e}a.serializeError=Ee;function Se(e,r={}){let{maxDepth:t=Number.POSITIVE_INFINITY}=r;if(e instanceof Error)return e;if(Te(e)){let s=F(e.name);return D({from:e,seen:[],to:new s,maxDepth:t,depth:0,serialize:!1})}return new S(e)}a.deserializeError=Se;function U(e){return!!e&&typeof e=="object"&&"name"in e&&"message"in e&&"stack"in e}a.isErrorLike=U;function Te(e){return!!e&&typeof e=="object"&&"message"in e&&!Array.isArray(e)}var ve=P();Object.defineProperty(a,"errorConstructors",{enumerable:!0,get:function(){return J(ve).default}})});var V=y(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.FunctionTracer=void 0;var ke=L(),R=M(),Ce=E(),N=class{constructor(r){this.reporter=r}traceThat(r,t){let s=typeof r=="string"?t:r,i=typeof r=="string"?r:r.name||"(anonymous)";return(...u)=>{if(!Ce.runtimeConfig.enabled)return s(...u);let f=(0,R.generateId)(),d=new Error().stack?.replaceAll(`
`,"").split("at ")?.map(c=>c.trim())?.slice(2),p=new Date().getTime(),n=c=>{let k=new Date().getTime();this.reporter.registerEvent({status:"error",callId:f,name:i,startEpochMs:p,endEpochMs:k,details:{arguments:u,error:(0,ke.serializeError)(c),callStack:d}})},o;try{o=s(...u)}catch(c){throw n(c),c}let _=c=>{let k=new Date().getTime();return this.reporter.registerEvent({status:"ok",callId:f,name:i,startEpochMs:p,endEpochMs:k,details:{callStack:d,arguments:u,return:c}}).catch(Y=>{console.error("traceThat: Couldn't connect to tracethat.dev server"),console.error(Y)}),c};return o instanceof Promise?o.then(_).catch(c=>(n(c),(0,R.sleep)(100).then(()=>Promise.reject(c)))):(_(o),o)}}};T.FunctionTracer=N});var G=y(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.traceThat=void 0;var Me=H(),Ae=V(),$=new Ae.FunctionTracer(Me.reporter);v.traceThat=$.traceThat.bind($)});var Pe=y(K=>{Object.defineProperty(K,"__esModule",{value:!0});var je=G(),z=E(),Oe={disableDevtools:z.disableDevtools,setServerUrl:z.setServerUrl,registerToken:z.registerToken};window.traceThat=je.traceThat;window.TT=Oe});Pe();})();
